<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tableau Graphémo – 3 niveaux</title>
  <style>
    html,body{height:100%;margin:0;padding:0;background:#f6f7fb;color:#1f2937;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans','Apple Color Emoji','Segoe UI Emoji';}
    body{display:flex;flex-direction:column;min-height:100vh;}
    .app{flex:1;display:flex;flex-direction:column;}
    header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#f6f7fb;}
    h1{margin:0;font-size:20px;font-weight:800;}
    .subtitle{margin-top:4px;color:#6b7280;font-size:14px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{appearance:none;border:1px solid #e5e7eb;background:#fff;border-radius:12px;padding:8px 12px;font-weight:600;cursor:pointer;}
    .board{flex:1;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:10px;overflow:auto}
    .col{background:#fff;border-radius:14px;display:flex;flex-direction:column;}
    .col header{padding:10px;border-radius:14px 14px 0 0;}
    .col h2{margin:0;font-size:16px}
    .col .hint{font-size:12px;color:#6b7280}
    .dropzone{flex:1;padding:10px;display:flex;flex-wrap:wrap;align-content:flex-start;gap:8px;border-top:1px dashed #e5e7eb;min-height:120px}
    .parking{padding:10px;background:#fff;border-top:1px solid #e5e7eb}
    .tags{display:flex;flex-wrap:wrap;gap:8px}
    .tag{user-select:none;touch-action:none;cursor:grab;padding:8px 12px;border-radius:999px;font-weight:600;font-size:15px;box-shadow:0 2px 4px rgba(0,0,0,.1);border:1px solid #e5e7eb;background:#fff}
    .tag[data-color="1"]{background:#e0f2fe}
    .tag[data-color="2"]{background:#fee2e2}
    .tag[data-color="3"]{background:#dcfce7}
    .dropzone.active{outline:3px solid #c7d2fe;outline-offset:-2px}
    .ghost{position:fixed;pointer-events:none;z-index:9999;opacity:.95;transform:translate(-50%, -50%) scale(1.02)}
    .col[data-level="1"] header{background:#e0f2fe}
    .col[data-level="2"] header{background:#fee2e2}
    .col[data-level="3"] header{background:#dcfce7}
    @media(max-width:900px){.board{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>Tableau Graphémo – 3 niveaux (CE1)</h1>
      <div class="subtitle">Déplace ton étiquette dans le bon niveau.</div>
      <div class="toolbar">
        <button id="resetAll">Réinitialiser</button>
        <button id="shuffle">Mélanger</button>
        <button id="clearSave">Effacer sauvegarde</button>
      </div>
    </header>
    <section class="board">
      <article class="col" data-level="1">
        <header>
          <h2>Niveau 1</h2>
          <div class="hint">5 mots • 1 phrase</div>
        </header>
        <div class="dropzone" data-target="lvl1"></div>
      </article>
      <article class="col" data-level="2">
        <header>
          <h2>Niveau 2</h2>
          <div class="hint">10 mots • 2 phrases</div>
        </header>
        <div class="dropzone" data-target="lvl2"></div>
      </article>
      <article class="col" data-level="3">
        <header>
          <h2>Niveau 3</h2>
          <div class="hint">10 mots • 3 phrases</div>
        </header>
        <div class="dropzone" data-target="lvl3"></div>
      </article>
    </section>
    <section class="parking">
      <h3>Étiquettes</h3>
      <div class="tags dropzone" data-target="parking"></div>
    </section>
  </div>
  <script>
  (function(){
    const NAMES = [
      "Amel","Ayoub","Souhayl","Assir","Assia","Luckygilio","Babacar","Ritaje","Mia","Ziane","Emma","Samia","Ilyan","Youcef","Romaissa","Aya","Sofiane","Fayçal"
    ];
    const STORAGE_KEY = 'graphemo-board-v1';
    const zones = {
      parking: document.querySelector('[data-target="parking"]'),
      lvl1: document.querySelector('[data-target="lvl1"]'),
      lvl2: document.querySelector('[data-target="lvl2"]'),
      lvl3: document.querySelector('[data-target="lvl3"]'),
    };
    function uid(name){return 'tag-'+name.normalize('NFD').replace(/[^\p{L}\p{N}]+/gu,'-').toLowerCase();}
    function createTag(name){
      const el=document.createElement('div');
      el.className='tag';el.textContent=name;el.id=uid(name);
      const palette=[1,2,3];el.dataset.color=palette[Math.floor(Math.random()*palette.length)];
      enablePointerDrag(el);return el;}
    function populate(){zones.parking.innerHTML='';NAMES.forEach(n=>zones.parking.appendChild(createTag(n)));}
    function serialize(){const data={};for(const[k,z]of Object.entries(zones)){data[k]=Array.from(z.children).map(ch=>ch.id);}localStorage.setItem(STORAGE_KEY,JSON.stringify(data));}
    function restore(){const raw=localStorage.getItem(STORAGE_KEY);if(!raw){populate();return;}try{const data=JSON.parse(raw);['parking','lvl1','lvl2','lvl3'].forEach(k=>{zones[k].innerHTML='';(data[k]||[]).forEach(id=>{const name=NAMES.find(n=>uid(n)===id)||id;zones[k].appendChild(createTag(name));});});}catch(e){populate();}}
    function resetAll(){zones.parking.innerHTML='';['lvl1','lvl2','lvl3'].forEach(k=>zones[k].innerHTML='');NAMES.forEach(n=>zones.parking.appendChild(createTag(n)));serialize();}
    function shuffle(){const arr=Array.from(zones.parking.children);for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));zones.parking.appendChild(arr[j]);}serialize();}
    document.getElementById('resetAll').addEventListener('click',resetAll);
    document.getElementById('shuffle').addEventListener('click',shuffle);
    document.getElementById('clearSave').addEventListener('click',()=>{localStorage.removeItem(STORAGE_KEY);resetAll();});
    let drag=null;
    function enablePointerDrag(el){el.addEventListener('pointerdown',onDown);}
    function onDown(e){const el=e.currentTarget;el.setPointerCapture(e.pointerId);drag={el};const ghost=el.cloneNode(true);ghost.classList.add('ghost');document.body.appendChild(ghost);drag.ghost=ghost;pos(e);window.addEventListener('pointermove',onMove);window.addEventListener('pointerup',onUp,{once:true});}
    function pos(e){if(!drag)return;drag.ghost.style.left=e.clientX+'px';drag.ghost.style.top=e.clientY+'px';}
    function zoneAt(x,y){const els=document.elementsFromPoint(x,y);return els.find(el=>el.classList&&el.classList.contains('dropzone'))||null;}
    function onMove(e){pos(e);} 
    function onUp(e){if(!drag)return;const z=zoneAt(e.clientX,e.clientY);if(z)z.appendChild(drag.el);serialize();drag.ghost.remove();drag=null;window.removeEventListener('pointermove',onMove);}
    restore();
  })();
  </script>
</body>
</html>
